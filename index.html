<!DOCTYPE html>
<meta charset="utf-8">
<style>

/* CSS goes here. */

</style>
<body>
<script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script>

/* JavaScript goes here. */

var width = 960,
	height = 1160;

var svg = d3.select("body").append("svg")
	.attr("width", width)
	.attr("height", height)
	.style("display", "block")
	.style("margin", "auto");


d3.json("uk.json", function(error, uk) {
	if (error) return console.error(error);

	var subunits = topojson.feature(uk, uk.objects.subunits);

	var projection = d3.geoAlbers()
		.center([0, 5])
		.rotate([-82.58, 0])
		.parallels([7, 38])
		.scale(900)
		.translate([width / 2, height / 2]);

	var path = d3.geoPath()
		.projection(projection);

	svg.append("path")
		.datum(subunits)
		.attr("d", path);

	d3.json("population.json", function(error, population) {

		var max = Number.MIN_VALUE, min = Number.MAX_VALUE;
		for (var key in population){
			if (max < population[key])
				max = population[key];
			if (min > population[key])
				min = population[key];
		}

		svg.selectAll(".subunit")
			.data(topojson.feature(uk, uk.objects.subunits).features)
			.enter().append("path")
			.style("fill", function(d){
				var colordepth = 255 - Math.round((population[d.properties.name] - min)*255/(max - min));
				console.log(d.properties.name + " "+ colordepth);
				return "rgba("+colordepth+","+colordepth+","+colordepth+",1)";
			})
			.attr("class", function(d) {
					return "subunit " + d.id; })
			.attr("d", path);
	});

});

</script>
